!function(t){var i="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["ppIs","ppEvents","ppElement","exports"],(function(e,n,s,a){i.ppPlayer=t(i,a,e,n,s)}));else if("undefined"!=typeof exports){var e={},n={},s={};try{e=require("pp-is")}catch(t){}try{n=require("pp-events")}catch(t){}try{s=require("pp-element")}catch(t){}t(i,exports,e,n,s)}else i.ppPlayer=t(i,{},i.ppIs,i.ppEvents,i.ppElement)}((function(t,i,e,n,s){var a=function(t,i,e,n,s){return`<video data-id='${s}' preload='auto' pp-player-id='${n}' src='${t}' data-index='${i}' class='${1==e?"show":"hide"}'  ></video>`},h=function(t,i){t.removeClass(!0===i?"hide":"show"),t.addClass(!0===i?"show":"hide")};return function(t){this.ID=0,this.ID_update=-1,this.Event=new ppEvents,this.update=!1,this.playlistUpdate=[],this.nextIndex=function(){return this.getIndex()+1<this.playlistLength()?this.getIndex()+1:0},this.waitForPlaylist=function(){setTimeout(function(){this.update?(this.applyUpdate(),this.index=0,this.containerReady()):this.waitForPlaylist()}.bind(this),5e3)},this.setPlaylistUpdate=function(t,i){e.isArray(t,function(t){this.update=!0,this.playlistUpdate=t,this.ID_update=i}.bind(this))},this.applyUpdate=function(){this.update&&(this.index=-1,this.playlist=this.playlistUpdate,this.update=!1,this.ID=this.ID_update,0==this.playlistLength()&&(this.container.html(""),this.waitForPlaylist()))},this.play=function(){var t=this.container.elem.querySelector("video.show");if(!e.isNull(t)){var i=ppElement(t);setTimeout(function(t){t.elem.play(),this.Event.emit("trackPlay",{track:t.attr("src"),index:t.data("index"),ID:t.data("id")})}.bind(this,i),0)}},this.Event.on("playlistEnd",this.applyUpdate.bind(this)),this.indexPlus=function(t){this.index<this.playlistLength()-1?this.index++:this.index=0,this.index==this.playlistLength()-1&&this.Event.emit("playlistEnd"),e.isFunction(t)&&t()},this.getIndex=function(){return this.index},this.changePlayer=function(t){var i=ppElement(t.target.parentElement.querySelector("video.hide")),e=ppElement(t.target);this.indexPlus(function(t,i){h(t,!1);var e=this.getTrack(this.nextIndex());t.attr("src",e),t.data("index",this.nextIndex()),t.data("id")==this.ID.toString()||t.data("id",this.ID),t.elem.preload="auto",h(i,!0),this.play()}.bind(this,e,i))},this.containerReady=function(){if(this.playlistLength()>0){if(0==this.container.elem.querySelectorAll("video.show,video.hide").length){var t=a(this.getTrack(this.getIndex()),this.getIndex(),!0,"A",this.ID);t+=a(this.getTrack(this.nextIndex()),this.nextIndex(),!1,"B",this.ID),this.container.html(t)}this.container.elem.querySelectorAll("video").forEach(function(t){t.addEventListener("ended",this.changePlayer.bind(this))}.bind(this)),this.Event.emit("playlistReady")}else this.waitForPlaylist()},this.Event.on("containerReady",this.containerReady.bind(this)),this.Event.on("playlistReady",this.play.bind(this)),this.index=ppIs.isUndefined(t.index)?0:t.index,this.container=null,this.playlist=[],this.getTrack=function(t){return this.playlist[t]},this.playlistLength=function(){return this.playlist.length},ppIs.isArray(t.playlist,function(t){this.playlist=t}.bind(this)),ppIs.isString(t.view,function(t){this.container=ppElement("[pp-player="+t+"]"),ppIs.isNull(this.container)||this.Event.emit("containerReady")}.bind(this))}}));